<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quem Chega aos 500 Primeiro</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #39FF14; /* Brighter neon green */
            --dark-green: #0A5A0A; /* Deeper green for accents */
            --background-dark: #121212; /* Very dark background */
            --background-medium: #1A1A1A; /* Slightly lighter for containers */
            --text-color-light: #E0FFE0; /* Off-white for general text */
            --border-color: var(--neon-green);
            --button-hover-bg: rgba(57, 255, 20, 0.2);
            --shadow-glow: rgba(57, 255, 20, 0.7); /* Stronger glow */
            --success-color: #00BFFF; /* Blue for success */
            --fail-color: #FF4500; /* Red for failure */
        }

        body {
            font-family: 'Roboto', sans-serif, 'Courier New', monospace;
            background-color: var(--background-dark);
            color: var(--text-color-light);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(145deg, #0A0A0A 0%, #121212 50%, #0A0A0A 100%);
            overflow: hidden; /* Prevent scrollbar from overlay content */
        }

        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(57, 255, 20, 0.05) 0%, transparent 70%);
            animation: backgroundPulse 15s infinite alternate;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        .container {
            background: var(--background-medium);
            padding: 40px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 0 30px var(--shadow-glow), inset 0 0 10px rgba(57, 255, 20, 0.3);
            width: 90%;
            max-width: 650px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            z-index: 10;
            animation: fadeInScale 0.5s ease-out;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(28px, 5vw, 42px);
            color: var(--neon-green);
            text-shadow: 0 0 15px var(--neon-green);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            animation: neonGlow 1.5s infinite alternate;
        }

        @keyframes neonGlow {
            from { text-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green); }
            to { text-shadow: 0 0 20px var(--neon-green), 0 0 30px var(--neon-green), 0 0 40px var(--neon-green); }
        }

        #output {
            background: #000;
            border: 2px solid var(--border-color);
            padding: 20px;
            border-radius: 8px;
            color: var(--text-color-light);
            font-size: clamp(15px, 2.5vw, 19px);
            text-shadow: 0 0 5px rgba(57, 255, 20, 0.5);
            line-height: 1.7;
            font-weight: bold;
            text-align: left;
            max-height: 300px;
            min-height: 120px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-green) var(--background-dark);
        }

        #output::-webkit-scrollbar {
            width: 8px;
        }

        #output::-webkit-scrollbar-track {
            background: var(--background-dark);
            border-radius: 10px;
        }

        #output::-webkit-scrollbar-thumb {
            background-color: var(--neon-green);
            border-radius: 10px;
            border: 2px solid var(--background-medium);
        }

        #output p {
            margin: 8px 0;
            padding: 2px 0;
        }

        #output p.success-message {
            color: var(--success-color);
            text-shadow: 0 0 8px rgba(0, 191, 255, 0.8);
        }

        #output p.fail-message {
            color: var(--fail-color);
            text-shadow: 0 0 8px rgba(255, 69, 0, 0.8);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #input {
            width: 100%;
            padding: 18px;
            box-sizing: border-box;
            background: #000;
            color: var(--neon-green);
            border: 2px solid var(--border-color);
            border-radius: 30px;
            font-family: 'Roboto', sans-serif;
            font-size: clamp(17px, 3.2vw, 22px);
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 8px rgba(57, 255, 20, 0.4);
        }

        #input:focus {
            border-color: var(--neon-green);
            box-shadow: 0 0 15px var(--shadow-glow);
            transform: scale(1.01);
        }

        .action-button {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(17px, 3.2vw, 22px);
            padding: 15px 30px;
            margin: 8px auto;
            background: var(--background-dark);
            color: var(--neon-green);
            border: 2px solid var(--border-color);
            border-radius: 30px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease, background 0.4s ease;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(57, 255, 20, 0.2), transparent);
            transition: 0.5s;
        }

        .action-button:hover::before {
            left: 100%;
        }

        .action-button:hover:not(:disabled) {
            background: var(--button-hover-bg);
            box-shadow: 0 0 20px var(--shadow-glow);
            transform: translateY(-3px) scale(1.02);
            color: var(--neon-green);
        }
        
        .action-button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 0 15px var(--shadow-glow);
            background-color: rgba(57, 255, 20, 0.4);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #0d0d0d;
            border-color: #333;
            color: #666;
            box-shadow: none;
            transform: none;
        }

        /* Main Menu Buttons */
        #mainMenuButtons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
            justify-content: center;
            align-items: center;
        }
        #mainMenuButtons .action-button {
            max-width: 350px;
        }

        @media (min-width: 600px) {
            #mainMenuButtons {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: flex-start;
                justify-content: center;
            }
            #mainMenuButtons .action-button {
                flex: 1 1 calc(50% - 20px); /* Two buttons per row with gap */
                margin: 10px;
            }
        }

        /* Custom Prompt Styling */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85); /* Darker, more immersive overlay */
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px); /* Subtle blur behind prompt */
        }

        .custom-prompt {
            background: var(--background-medium);
            padding: 35px;
            border: 2px solid var(--neon-green);
            border-radius: 12px;
            z-index: 10000;
            width: 90%;
            max-width: 500px;
            text-align: center;
            color: var(--text-color-light);
            font-family: 'Roboto', sans-serif;
            box-shadow: 0 0 35px var(--shadow-glow), inset 0 0 10px rgba(57, 255, 20, 0.4);
            animation: promptEntry 0.3s ease-out;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
        }

        @keyframes promptEntry {
            from { opacity: 0; transform: translate(-50%, -45%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .custom-prompt p {
            font-size: clamp(19px, 4.8vw, 26px);
            margin-bottom: 25px;
            text-shadow: 0 0 10px var(--neon-green);
            font-weight: bold;
            line-height: 1.5;
        }

        .custom-prompt input {
            font-size: clamp(17px, 3.8vw, 22px);
            padding: 18px;
            width: 90%;
            max-width: 350px;
            margin: 20px auto;
            text-align: center;
            background: #000;
            color: var(--neon-green);
            border: 2px solid var(--border-color);
            border-radius: 30px;
            font-family: 'Roboto', sans-serif;
            outline: none;
            box-shadow: 0 0 8px rgba(57, 255, 20, 0.4);
            transition: all 0.3s ease;
        }
        .custom-prompt input:focus {
            border-color: var(--neon-green);
            box-shadow: 0 0 15px var(--shadow-glow);
        }

        .custom-prompt .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }

        .custom-prompt button {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(17px, 3.8vw, 22px);
            padding: 15px 40px;
            margin: 0 auto;
            background: var(--dark-green);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.6);
            width: 85%;
            max-width: 280px;
            text-transform: uppercase;
        }

        .custom-prompt button.secondary {
            background-color: #333;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
            color: var(--text-color-light);
        }
        .custom-prompt button.secondary:hover {
            background-color: #555;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
        }

        .custom-prompt button:hover {
            background: var(--neon-green);
            transform: translateY(-3px);
            box-shadow: 0 0 25px var(--shadow-glow);
            color: var(--background-dark); /* Text color change on hover for contrast */
        }
        .custom-prompt button:active {
            transform: translateY(0);
            box-shadow: 0 0 15px var(--shadow-glow);
        }

        /* Timer Styling */
        #gameTimer {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: var(--neon-green);
            padding: 10px 18px;
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            font-size: clamp(16px, 2.8vw, 20px);
            border: 1px solid var(--border-color);
            box-shadow: 0 0 12px rgba(57, 255, 20, 0.5);
            z-index: 1001;
            min-width: 100px; /* Ensure it doesn't shrink too much */
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
                width: 95%;
                gap: 18px;
            }
            h1 {
                font-size: clamp(26px, 6.5vw, 40px);
            }
            #output {
                max-height: 250px;
                min-height: 100px;
                font-size: clamp(14px, 2.8vw, 18px);
                padding: 15px;
            }
            .action-button {
                max-width: 100%;
                font-size: clamp(16px, 4vw, 20px);
                padding: 12px 25px;
            }
            #mainMenuButtons .action-button {
                flex: 1 1 100%; /* Stack buttons on smaller tablets */
                margin: 8px 0;
            }
            .custom-prompt {
                padding: 25px;
            }
            .custom-prompt p {
                font-size: clamp(17px, 5.5vw, 24px);
                margin-bottom: 20px;
            }
            .custom-prompt input {
                font-size: clamp(15px, 4.5vw, 20px);
                padding: 15px;
            }
            .custom-prompt button {
                font-size: clamp(15px, 4.5vw, 20px);
                padding: 12px 30px;
            }
            #gameTimer {
                font-size: clamp(14px, 3.5vw, 18px);
                padding: 8px 12px;
                top: 15px;
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                gap: 15px;
            }
            h1 {
                font-size: clamp(22px, 7vw, 36px);
                padding-bottom: 10px;
            }
            #output {
                font-size: clamp(13px, 3.5vw, 17px);
                max-height: 180px;
                min-height: 80px;
                padding: 12px;
            }
            .action-button {
                font-size: clamp(15px, 4.5vw, 19px);
                padding: 10px 20px;
            }
            .custom-prompt {
                padding: 20px;
            }
            .custom-prompt p {
                font-size: clamp(15px, 6vw, 22px);
                margin-bottom: 15px;
            }
            .custom-prompt input {
                font-size: clamp(13px, 5vw, 18px);
                padding: 12px;
            }
            .custom-prompt .button-group {
                gap: 10px;
                margin-top: 15px;
            }
            .custom-prompt button {
                font-size: clamp(13px, 5vw, 18px);
                padding: 10px 25px;
            }
            #gameTimer {
                font-size: clamp(12px, 4vw, 16px);
                padding: 6px 10px;
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="gameTimer">00:00:00</div>
    <div class="container">
        <h1>Quem Chega aos 500 Primeiro</h1>
        <div id="output"></div>
        <div id="mainMenuButtons"></div> 

        <input type="text" id="input" placeholder="Digite sua escolha..." style="display:none;" />
        <button id="submit" class="action-button" style="display:none;">🎲 Enviar</button>
        <button id="reset" class="action-button" style="display:none;">🔄 Reiniciar Jogo</button>
    </div>
    <script>
        let saldoDinheiro = 5.0;
        let quantidadeGarrafasAgua = 0;
        let ganhouRifa = false;
        let finalTime = "00:00:00"; // Variável para armazenar o tempo final
        const MAX_GARRAFAS = 12; // Define o limite máximo de garrafas

        // Lista de desculpas engraçadas
        const funnyExcuses = [
            "Ah, eu acabei de tomar um banho de chuva, estou hidratado por osmose!",
            "Meu cachorro comeu meu dinheiro da água. De novo.",
            "Estou em uma dieta de ar. Água estraga o plano.",
            "Prefiro água diretamente da nuvem, é mais fresca.",
            "Acabei de regar minhas plantas e bebi o que sobrou. Elas não se importam.",
            "Tenho que guardar meu dinheiro para a mensalidade do clube de caça-níqueis submarino.",
            "Minha avó disse que água demais enferruja as articulações.",
            "Estou economizando para um jet ski. Água potável é um luxo desnecessário.",
            "Ouvir a água me faz ter vontade de ir ao banheiro, e não posso agora.",
            "Minha alma já está úmida. Obrigado!",
            "Acabei de gargarejar com um gole de café, é praticamente a mesma coisa.",
            "Estou tentando me tornar um camelo. Preciso treinar a sede.",
            "Meu horóscopo disse para evitar líquidos hoje. Questão de destino.",
            "Tenho alergia a H2O... só consigo beber C2H5OH.",
            "Estou esperando o dia em que a água seja saborizada com gosto de pizza.",
            "Não posso, estou em uma competição de quem fica mais tempo sem piscar... e sem beber.",
            "Se eu beber água agora, vou perder o dom de adivinhar o tempo olhando para as nuvens.",
            "Desculpe, estou em processo de desidratação artística. É uma nova tendência.",
            "Minha bexiga acabou de me mandar um ultimato. Não posso arriscar.",
            "Estou testando uma nova tecnologia que me permite absorver umidade do ar.",
            "Já bebi o suficiente para hoje. O suficiente para duas pessoas, na verdade.",
            "Meu terapeuta disse para eu evitar compromissos com líquidos.",
            "Estou treinando para ser um mímico. Não posso falar, muito menos beber.",
            "A última vez que bebi água, comecei a flutuar. É um risco que não posso correr.",
            "Hoje é meu dia de 'ficar seco'. Amanhã eu volto ao normal, prometo!"
        ];

        // Elogios para quando vende água
        const compliments = [
            "Excelente jogada! Seu faro para negócios é impressionante. ✨",
            "Uau, que empreendedorismo! Você tem o toque de Midas! 💪",
            "Parabéns pela venda! É assim que se constrói um império. ✨",
            "Mandou bem! Sua persistência está dando frutos. 💪",
            "Isso aí! Foco e determinação, continue assim! ✨"
        ];

        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const submitButton = document.getElementById('submit');
        const resetButton = document.getElementById('reset');
        const mainMenuButtonsDiv = document.getElementById('mainMenuButtons'); 
        const gameTimerElement = document.getElementById('gameTimer'); 
        
        let startTime;
        let timerInterval;

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            finalTime = gameTimerElement.textContent; // Armazena o tempo final
        }

        function resetTimer() {
            stopTimer();
            gameTimerElement.textContent = '00:00:00';
            startTimer();
        }

        function updateTimer() {
            const elapsedTime = Date.now() - startTime;
            const totalSeconds = Math.floor(elapsedTime / 1000);

            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            const format = (num) => num < 10 ? '0' + num : num;
            gameTimerElement.textContent = `${format(hours)}:${format(minutes)}:${format(seconds)}`;
        }

        function atualizarSaida(mensagem, type = 'normal') {
            const p = document.createElement('p');
            p.innerHTML = mensagem.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Render bold text
            if (type === 'success') {
                p.classList.add('success-message');
            } else if (type === 'fail') {
                p.classList.add('fail-message');
            }
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
        }

        function customPrompt(message, options = []) {
            return new Promise(resolve => {
                const overlay = document.createElement('div');
                overlay.className = 'overlay';
                
                const promptDiv = document.createElement('div');
                promptDiv.className = 'custom-prompt';
                
                let contentHtml = `<p>${message}</p>`;
                if (options.length > 0) {
                    contentHtml += '<div class="button-group">';
                    options.forEach(option => {
                        contentHtml += `<button data-value="${option.value}" class="${option.className || ''}">${option.text}</button>`;
                    });
                    contentHtml += '</div>';
                } else {
                    contentHtml += `
                        <input type="text" autofocus>
                        <div class="button-group">
                            <button id="promptOkButton">OK</button>
                        </div>
                    `;
                }
                promptDiv.innerHTML = contentHtml;
                
                document.body.appendChild(overlay);
                document.body.appendChild(promptDiv);
                
                const promptInput = promptDiv.querySelector('input');
                
                if (promptInput) {
                    promptInput.focus();
                    const promptOkButton = promptDiv.querySelector('#promptOkButton');
                    const submitAndResolve = () => {
                        const value = promptInput.value;
                        document.body.removeChild(overlay);
                        document.body.removeChild(promptDiv);
                        resolve(value);
                    };
                    promptOkButton.addEventListener('click', submitAndResolve);
                    promptInput.addEventListener('keypress', (event) => {
                        if (event.key === 'Enter') {
                            event.preventDefault(); // Prevent default Enter key behavior (like form submission)
                            submitAndResolve();
                        }
                    });
                } else {
                    promptDiv.querySelectorAll('.button-group button').forEach(button => {
                        button.addEventListener('click', () => {
                            document.body.removeChild(overlay);
                            document.body.removeChild(promptDiv);
                            resolve(button.dataset.value);
                        });
                    });
                }
            });
        }

        
        function iniciarJogo() {
            resetTimer(); // Inicia o timer ao iniciar o jogo
            atualizarSaida("Bem-vindo ao Jogo **Quem Chega aos 500 Primeiro**! Seu objetivo é transformar seus **5 Kredits** iniciais em **500 Kredits**.");
            atualizarSaida("Você encontrou **5 Kredits** no bolso do casaco! O que você vai fazer com eles?");
            menuPrincipal();
        }

        function menuPrincipal() {
           atualizarSaida(`\n💰 Saldo Atual: **${saldoDinheiro.toFixed(2)} K** | 💧 Garrafas d'Água: **${quantidadeGarrafasAgua}/${MAX_GARRAFAS}**`);
            atualizarSaida("Escolha sua estratégia:");
            
            // Clear existing main menu buttons
            mainMenuButtonsDiv.innerHTML = '';
            mainMenuButtonsDiv.style.display = 'flex'; // Ensure it's visible

            // Hide input and submit button for main menu
            input.style.display = 'none';
            submitButton.style.display = 'none';

            // Create and append main menu buttons
            const raffleButton = document.createElement('button');
            raffleButton.className = 'action-button';
            raffleButton.textContent = '🎲 Jogar na rifa (Custo: 5 Kredits por bilhete - Prêmio: 500 Kredits)';
            raffleButton.addEventListener('click', async () => {
                // Disable main menu buttons temporarily
                Array.from(mainMenuButtonsDiv.children).forEach(btn => btn.disabled = true);
                await jogarRifa();
                Array.from(mainMenuButtonsDiv.children).forEach(btn => btn.disabled = false); // Re-enable
            });
            mainMenuButtonsDiv.appendChild(raffleButton);

            const manageBottlesButton = document.createElement('button');
            manageBottlesButton.className = 'action-button';
            manageBottlesButton.textContent = "💧 Gerenciar Garrafas d'Água (Comprar/Vender)";
            manageBottlesButton.addEventListener('click', async () => {
                // Disable main menu buttons temporarily
                Array.from(mainMenuButtonsDiv.children).forEach(btn => btn.disabled = true);
                await gerenciarGarrafas();
                Array.from(mainMenuButtonsDiv.children).forEach(btn => btn.disabled = false); // Re-enable
            });
            mainMenuButtonsDiv.appendChild(manageBottlesButton);

            resetButton.style.display = 'none'; // Ensure reset button is hidden in main menu
        }

        async function jogarRifa() {
            // Hide main menu buttons before showing prompt
            mainMenuButtonsDiv.style.display = 'none';

            if (saldoDinheiro < 5.0) {
                atualizarSaida("\nVocê não tem saldo suficiente para jogar na rifa (requer no mínimo **5 Kredits**).", 'fail');
                verificarFimJogo();
                return;
            }

            let quantidadeRifasStr = await customPrompt(`Seu saldo atual: ${saldoDinheiro.toFixed(2)} K\nQuantas rifas você deseja comprar (5 Kredits cada)?`);
            let quantidadeRifas = parseInt(quantidadeRifasStr);

            if (isNaN(quantidadeRifas) || quantidadeRifas <= 0) {
                atualizarSaida("Quantidade inválida de rifas.", 'fail');
                verificarFimJogo();
                return;
            }

            const custoTotalRifas = quantidadeRifas * 5.0;

            if (saldoDinheiro < custoTotalRifas) {
                atualizarSaida(`Saldo insuficiente! Você precisa de **${(custoTotalRifas - saldoDinheiro).toFixed(2)} K** a mais para comprar ${quantidadeRifas} rifa(s).`, 'fail');
                verificarFimJogo();
                return;
            }

            saldoDinheiro -= custoTotalRifas;
            atualizarSaida(`Você comprou **${quantidadeRifas}** bilhete(s) de rifa, gastando **${custoTotalRifas.toFixed(2)} K**.`);

            let numerosEscolhidosStr = await customPrompt(`Digite ${quantidadeRifas} número(s) que você escolheu para a rifa, separados por vírgula (entre 1 e 1000). Você pode digitar menos ou mais números, mas o sorteio será baseado na quantidade de rifas que você comprou. Ex: 10, 55, 120`);
            let numerosEscolhidos = numerosEscolhidosStr.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num) && num >= 1 && num <= 1000);
            
            // Limit the chosen numbers to the quantity of bought tickets
            if (numerosEscolhidos.length > quantidadeRifas) {
                numerosEscolhidos = numerosEscolhidos.slice(0, quantidadeRifas);
                atualizarSaida(`Você inseriu mais números do que rifas compradas. Apenas os primeiros **${quantidadeRifas}** números serão considerados: **${numerosEscolhidos.join(', ')}**`);
            } else if (numerosEscolhidos.length < quantidadeRifas) {
                atualizarSaida(`Você inseriu menos números do que rifas compradas. Seus números: **${numerosEscolhidos.join(', ')}**`);
            }
            
            if (numerosEscolhidos.length === 0) {
                atualizarSaida("Nenhum número válido foi inserido para a rifa. Você não participará do sorteio.", 'fail');
                // Consider if you want to refund here or just continue without participation
                verificarFimJogo();
                return;
            }

            atualizarSaida(`Seus números escolhidos para o sorteio: **${numerosEscolhidos.join(', ')}**`);

            let numeroSorteado = Math.floor(Math.random() * 1000) + 1; // Apenas um número é sorteado
            atualizarSaida(`O número sorteado na rifa foi: **${numeroSorteado}**`);

            let acertou = false;
            for (let i = 0; i < numerosEscolhidos.length; i++) {
                if (numerosEscolhidos[i] === numeroSorteado) {
                    acertou = true;
                    break; // Se acertou um, não precisa verificar os outros
                }
            }

            if (acertou) {
                saldoDinheiro += 500.0; // Ganha 500 Kredits apenas uma vez se acertar
                ganhouRifa = true;
                atualizarSaida(`🎉 **PARABÉNS!** Um dos seus números (**${numeroSorteado}**) foi sorteado na rifa e você ganhou **500 Kredits**!`, 'success');
            } else {
                atualizarSaida("😥 Que pena! Nenhum dos seus números foi sorteado na rifa.", 'fail');
            }
            verificarFimJogo();
        }

        async function gerenciarGarrafas() {
            // Hide main menu buttons before showing prompt
            mainMenuButtonsDiv.style.display = 'none';

            const options = [
                { text: 'Comprar Garrafas', value: '1' },
                { text: 'Tentar Vender uma Garrafa', value: '2' },
                { text: 'Voltar ao menu principal', value: '3', className: 'secondary' }
            ];
            let subEscolhaAgua = await customPrompt("ESCOLHA UMA OPÇÃO:", options);
            subEscolhaAgua = parseInt(subEscolhaAgua); // Ensure it's a number

            if (isNaN(subEscolhaAgua)) {
                atualizarSaida("Escolha inválida! Por favor, selecione uma das opções.", 'fail');
                verificarFimJogo();
                return;
            }

            if (subEscolhaAgua === 1) {
                let precoCompraGarrafa = (Math.floor(Math.random() * (250 - 159 + 1)) + 159) / 100.0;
                let garrafasComprar = parseInt(await customPrompt(`Seu saldo atual: ${saldoDinheiro.toFixed(2)} K\nQuantas garrafas d'água você deseja comprar (${precoCompraGarrafa.toFixed(2)} K cada)?`));

                if (isNaN(garrafasComprar) || garrafasComprar <= 0) {
                    atualizarSaida("Número inválido de garrafas para comprar.", 'fail');
                    verificarFimJogo();
                    return;
                }

                // Verifica o limite de garrafas
                if (quantidadeGarrafasAgua + garrafasComprar > MAX_GARRAFAS) {
                    atualizarSaida(`Você só consegue carregar no máximo **${MAX_GARRAFAS}** garrafas d'água por vez!`, 'fail');
                    verificarFimJogo();
                    return;
                }

                let custoTotal = garrafasComprar * precoCompraGarrafa;
                if (saldoDinheiro >= custoTotal) {
                    saldoDinheiro -= custoTotal;
                    quantidadeGarrafasAgua += garrafasComprar;
                    atualizarSaida(`Você comprou **${garrafasComprar}** garrafa(s) d'água. Seu saldo atual é **${saldoDinheiro.toFixed(2)} K**.`, 'success');
                } else {
                    atualizarSaida(`Saldo insuficiente! Você precisa de **${(custoTotal - saldoDinheiro).toFixed(2)} K** a mais para comprar ${garrafasComprar} garrafa(s).`, 'fail');
                }
            } else if (subEscolhaAgua === 2) {
                if (quantidadeGarrafasAgua > 0) {
                    let chanceVenda = Math.floor(Math.random() * 100) + 1;
                    if (chanceVenda <= 20) { // 20% chance to sell for 5.00 K
                        saldoDinheiro += 5.0;
                        quantidadeGarrafasAgua -= 1;
                        const randomCompliment = compliments[Math.floor(Math.random() * compliments.length)];
                        atualizarSaida(`✅ ${randomCompliment}`, 'success');
                    } else {
                        // Sorteia uma desculpa engraçada
                        const randomIndex = Math.floor(Math.random() * funnyExcuses.length);
                        const randomExcuse = funnyExcuses[randomIndex];
                        atualizarSaida(`🗣️ "${randomExcuse}" A garrafa continua com você.`, 'fail');
                    }
                } else {
                    atualizarSaida("Você não tem garrafas d'água para vender! Compre algumas primeiro.", 'fail');
                }
            } else if (subEscolhaAgua === 3) {
                // Do nothing, just return to menu via verificarFimJogo
            } else {
                atualizarSaida("Escolha inválida! Por favor, selecione uma das opções.", 'fail');
            }
            verificarFimJogo();
        }

        function verificarFimJogo() {
            if (saldoDinheiro >= 500.0 || ganhouRifa) {
                finalizarJogo("ganhou");
            } else if (saldoDinheiro < 5.0 && quantidadeGarrafasAgua === 0) {
                finalizarJogo("perdeu");
            } else {
                menuPrincipal(); // Always return to main menu if game isn't over
            }
        }

        function finalizarJogo(status) {
            stopTimer(); // Para o timer ao finalizar o jogo
            submitButton.disabled = true; // Disable main submit button
            input.disabled = true; // Disable main input
            input.style.display = 'none'; // Hide input
            submitButton.style.display = 'none'; // Hide submit button
            mainMenuButtonsDiv.style.display = 'none'; // Hide main menu buttons

            atualizarSaida("\n--- Fim do Jogo ---");
            atualizarSaida(`Tempo de Jogo: ⏱️ **${finalTime}**`);
            atualizarSaida(`Saldo Final: 💰 **${saldoDinheiro.toFixed(2)} K**`);

            if (status === "ganhou") {
                atualizarSaida("🏆 **PARABÉNS!** Você alcançou seu objetivo de **500 Kredits**!", 'success');
                // Adicionar a mensagem de print e Instagram aqui
                atualizarSaida("🥳 **Conseguiu!** Que tal tirar um print da sua vitória e postar no Instagram? Não esqueça de me marcar: **@dan_bra** para eu repostar!", 'success');
            } else {
                atualizarSaida("😢 **Que pena!** Seu saldo ficou abaixo de **5 Kredits** e você não tem mais garrafas para vender. Você não tem mais capital para continuar.", 'fail');
            }
            resetButton.style.display = 'block';
        }

        resetButton.addEventListener('click', () => {
            saldoDinheiro = 5.0;
            quantidadeGarrafasAgua = 0;
            ganhouRifa = false;
            output.innerHTML = '';
            resetButton.style.display = 'none';
            iniciarJogo();
        });

        window.onload = iniciarJogo;
    </script>
</body>
</html>